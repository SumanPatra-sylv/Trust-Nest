<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trust Nest - Senior Protection Simulator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0f;
            color: #fff;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2rem;
            color: #fff;
            margin-bottom: 8px;
        }

        h1 span {
            color: #22c55e;
        }

        .subtitle {
            color: #666;
            font-size: 0.95rem;
        }

        .layout {
            display: grid;
            grid-template-columns: 300px 1fr 320px;
            gap: 20px;
            min-height: 600px;
        }

        /* Scenarios Panel */
        .scenarios {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .scenarios h2 {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }

        .scenario-btn {
            width: 100%;
            padding: 14px 16px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #fff;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
        }

        .scenario-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .scenario-btn.active {
            background: rgba(139, 92, 246, 0.2);
            border-color: #8b5cf6;
        }

        .scenario-icon {
            font-size: 1.2rem;
            margin-right: 10px;
        }

        .scenario-name {
            font-weight: 500;
            display: block;
        }

        .scenario-type {
            font-size: 0.75rem;
            color: #666;
            margin-top: 4px;
        }

        /* Phone Simulator */
        .phone {
            background: linear-gradient(180deg, #1a1a24 0%, #12121a 100%);
            border-radius: 40px;
            padding: 15px;
            max-width: 380px;
            margin: 0 auto;
            border: 3px solid #2a2a35;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }

        .phone-notch {
            width: 120px;
            height: 25px;
            background: #000;
            border-radius: 0 0 15px 15px;
            margin: 0 auto 15px;
        }

        .phone-screen {
            background: #0f0f14;
            border-radius: 25px;
            min-height: 500px;
            overflow: hidden;
        }

        .phone-header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: #888;
        }

        .phone-content {
            padding: 20px;
        }

        /* Incoming Call UI */
        .incoming-call {
            text-align: center;
            padding: 40px 20px;
        }

        .caller-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin: 0 auto 20px;
        }

        .caller-name {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .caller-number {
            color: #666;
            margin-bottom: 20px;
        }

        .call-status {
            font-size: 0.9rem;
            color: #22c55e;
            margin-bottom: 30px;
        }

        .call-duration {
            font-size: 2rem;
            font-weight: 300;
            color: #fff;
            margin: 20px 0;
        }

        .call-actions {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 30px;
        }

        .call-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .call-btn.decline {
            background: #ef4444;
        }

        .call-btn.accept {
            background: #22c55e;
        }

        /* SMS UI */
        .sms-notification {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 15px;
            border-left: 4px solid #3b82f6;
        }

        .sms-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .sms-sender {
            font-weight: 600;
        }

        .sms-time {
            color: #666;
            font-size: 0.8rem;
        }

        .sms-body {
            color: #ccc;
            line-height: 1.5;
        }

        /* Warning Overlay */
        .warning-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 25px;
            z-index: 10;
        }

        .warning-content {
            text-align: center;
            padding: 30px;
        }

        .warning-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .warning-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .warning-title.scam {
            color: #ef4444;
        }

        .warning-title.suspicious {
            color: #fbbf24;
        }

        .warning-title.safe {
            color: #22c55e;
        }

        .warning-reason {
            color: #aaa;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .warning-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .warning-btn {
            padding: 14px 24px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .warning-btn.primary {
            background: #ef4444;
            color: #fff;
        }

        .warning-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        /* Analysis Panel */
        .analysis {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .analysis h2 {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }

        .analysis-section {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .analysis-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 0.75rem;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .rule-trigger {
            display: inline-block;
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            margin: 3px;
        }

        .ml-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .ml-label {
            font-weight: 500;
        }

        .ml-confidence {
            color: #888;
        }

        .confidence-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #ef4444);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .decision-box {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .decision-box.scam {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .decision-box.suspicious {
            background: rgba(251, 191, 36, 0.15);
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .decision-box.safe {
            background: rgba(34, 197, 94, 0.15);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .decision-verdict {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .decision-verdict.scam {
            color: #ef4444;
        }

        .decision-verdict.suspicious {
            color: #fbbf24;
        }

        .decision-verdict.safe {
            color: #22c55e;
        }

        .explanation {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid #8b5cf6;
        }

        .explanation-en {
            margin-bottom: 8px;
            color: #ddd;
        }

        .explanation-hi {
            color: #888;
            font-style: italic;
        }

        .guardian-alert {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.05));
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .guardian-icon {
            font-size: 1.5rem;
        }

        .guardian-text {
            font-size: 0.9rem;
        }

        .guardian-status {
            color: #22c55e;
            font-weight: 500;
            margin-top: 5px;
        }

        .timeline {
            position: relative;
            padding-left: 20px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(255, 255, 255, 0.1);
        }

        .timeline-item {
            position: relative;
            padding: 10px 0 10px 15px;
            font-size: 0.85rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -5px;
            top: 14px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #8b5cf6;
        }

        .timeline-time {
            color: #666;
            font-size: 0.75rem;
        }

        .hidden {
            display: none !important;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .pulsing {
            animation: pulse 1.5s infinite;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-5px);
            }

            75% {
                transform: translateX(5px);
            }
        }

        .shaking {
            animation: shake 0.3s infinite;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>üõ°Ô∏è Trust <span>Nest</span></h1>
            <p class="subtitle">Senior Protection Simulator ‚Äî Scenario-Based Demo</p>
        </header>

        <div class="layout">
            <!-- Scenarios Panel -->
            <div class="scenarios">
                <h2>üìã Scenarios</h2>

                <button class="scenario-btn" onclick="runScenario('sms_otp')">
                    <span class="scenario-icon">üì±</span>
                    <span class="scenario-name">OTP Phishing SMS</span>
                    <span class="scenario-type">SMS ‚Ä¢ Rule Trigger ‚Ä¢ High Risk</span>
                </button>

                <button class="scenario-btn" onclick="runScenario('call_unknown')">
                    <span class="scenario-icon">üìû</span>
                    <span class="scenario-name">Unknown Caller</span>
                    <span class="scenario-type">Call ‚Ä¢ Metadata Check</span>
                </button>

                <button class="scenario-btn" onclick="runScenario('call_long')">
                    <span class="scenario-icon">‚è±Ô∏è</span>
                    <span class="scenario-name">Long Call Warning</span>
                    <span class="scenario-type">Call ‚Ä¢ 5+ min duration</span>
                </button>

                <button class="scenario-btn" onclick="runScenario('digital_arrest')">
                    <span class="scenario-icon">üö®</span>
                    <span class="scenario-name">Digital Arrest Attempt</span>
                    <span class="scenario-type">Video Call ‚Ä¢ Critical Alert</span>
                </button>

                <button class="scenario-btn" onclick="runScenario('family_scam')">
                    <span class="scenario-icon">üë®‚Äçüë©‚Äçüëß</span>
                    <span class="scenario-name">Family Impersonation</span>
                    <span class="scenario-type">WhatsApp ‚Ä¢ Guardian Alert</span>
                </button>

                <button class="scenario-btn" onclick="runScenario('safe_msg')">
                    <span class="scenario-icon">‚úÖ</span>
                    <span class="scenario-name">Legitimate Message</span>
                    <span class="scenario-type">SMS ‚Ä¢ Safe Pass</span>
                </button>
            </div>

            <!-- Phone Simulator -->
            <div style="position: relative;">
                <div class="phone">
                    <div class="phone-notch"></div>
                    <div class="phone-screen" id="phoneScreen">
                        <div class="phone-header">
                            <span>9:41 AM</span>
                            <span>üì∂ WiFi üîã</span>
                        </div>
                        <div class="phone-content" id="phoneContent">
                            <div style="text-align: center; padding: 100px 20px; color: #666;">
                                <p style="font-size: 3rem; margin-bottom: 20px;">üëà</p>
                                <p>Select a scenario to begin</p>
                            </div>
                        </div>
                    </div>

                    <!-- Warning Overlay -->
                    <div class="warning-overlay hidden" id="warningOverlay">
                        <div class="warning-content" id="warningContent">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analysis Panel -->
            <div class="analysis">
                <h2>üîç System Analysis</h2>

                <div class="analysis-section">
                    <div class="section-title">Pipeline Status</div>
                    <div class="timeline" id="pipelineTimeline">
                        <div class="timeline-item" style="color: #666;">
                            Waiting for scenario...
                        </div>
                    </div>
                </div>

                <div class="analysis-section">
                    <div class="section-title">Rule Engine</div>
                    <div id="ruleResults">
                        <span style="color: #666;">No rules triggered</span>
                    </div>
                </div>

                <div class="analysis-section">
                    <div class="section-title">DistilBERT ML</div>
                    <div id="mlResults">
                        <div class="ml-result">
                            <span class="ml-label">‚Äî</span>
                            <span class="ml-confidence">Waiting...</span>
                        </div>
                    </div>
                </div>

                <div class="analysis-section">
                    <div class="section-title">System Decision</div>
                    <div id="systemDecision">
                        <div class="decision-box safe">
                            <div class="decision-verdict safe">‚Äî</div>
                            <div style="color: #888;">Awaiting input</div>
                        </div>
                    </div>
                </div>

                <div class="analysis-section">
                    <div class="section-title">Explainability</div>
                    <div id="explainability">
                        <div class="explanation">
                            <div class="explanation-en">System will explain its decision here</div>
                            <div class="explanation-hi">‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§®‡§æ ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§∏‡§Æ‡§ù‡§æ‡§è‡§ó‡§æ</div>
                        </div>
                    </div>
                </div>

                <div class="analysis-section">
                    <div class="section-title">Guardian Mode</div>
                    <div id="guardianStatus">
                        <div style="color: #666; font-size: 0.9rem;">
                            üë®‚Äçüë©‚Äçüëß Guardian paired: <strong>Son (Rahul)</strong><br>
                            <span style="color: #22c55e;">‚óè Online</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Scenario definitions
        const scenarios = {
            sms_otp: {
                type: 'sms',
                sender: '+91-98765-XXXXX',
                senderName: 'Unknown',
                message: 'Dear Customer, Your SBI account will be blocked. Share OTP 482951 to verify your account immediately.',
                rules: ['OTP_REQUEST', 'THREAT', 'URGENCY'],
                ml: { label: 'SCAM', confidence: 0.78 },
                verdict: 'SCAM',
                confidence: 0.92,
                explanation_en: 'Contains OTP request. Banks NEVER ask for OTP via SMS.',
                explanation_hi: 'OTP ‡§Æ‡§æ‡§Å‡§ó‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à‡•§ ‡§¨‡•à‡§Ç‡§ï ‡§ï‡§≠‡•Ä SMS ‡§∏‡•á OTP ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§æ‡§Å‡§ó‡§§‡•á‡•§',
                escalate: true,
                escalateReason: 'High-risk OTP phishing detected'
            },
            call_unknown: {
                type: 'call',
                caller: '+91-70XX-XXX-XXX',
                callerName: 'Unknown Number',
                duration: 0,
                rules: ['UNKNOWN_CALLER'],
                ml: { label: 'SUSPICIOUS', confidence: 0.52 },
                verdict: 'SUSPICIOUS',
                confidence: 0.65,
                explanation_en: 'Unknown caller. Proceed with caution.',
                explanation_hi: '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§ ‡§ï‡•â‡§≤‡§∞‡•§ ‡§∏‡§æ‡§µ‡§ß‡§æ‡§®‡•Ä ‡§¨‡§∞‡§§‡•á‡§Ç‡•§',
                escalate: false
            },
            call_long: {
                type: 'call_active',
                caller: '+91-70XX-XXX-XXX',
                callerName: 'Unknown Number',
                duration: 312,
                rules: ['LONG_CALL_DURATION'],
                ml: { label: 'SUSPICIOUS', confidence: 0.61 },
                verdict: 'SUSPICIOUS',
                confidence: 0.70,
                explanation_en: 'Call exceeds 5 minutes with unknown number. Check if they asked for money or OTP.',
                explanation_hi: '5 ‡§Æ‡§ø‡§®‡§ü ‡§∏‡•á ‡§ú‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§Ö‡§ú‡•ç‡§û‡§æ‡§§ ‡§®‡§Ç‡§¨‡§∞ ‡§∏‡•á ‡§¨‡§æ‡§§‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§™‡•à‡§∏‡•á ‡§Ø‡§æ OTP ‡§Æ‡§æ‡§Å‡§ó‡§æ?',
                escalate: true,
                escalateReason: 'Extended call with unknown number'
            },
            digital_arrest: {
                type: 'video_call',
                caller: '+91-HIDDEN',
                callerName: 'CBI/Police (Claimed)',
                message: 'You are under DIGITAL ARREST. Stay on video call. Do not disconnect. Transfer ‚Çπ2,50,000 to clear your name.',
                rules: ['DIGITAL_ARREST', 'AUTHORITY_IMPERSONATION', 'THREAT'],
                ml: { label: 'SCAM', confidence: 0.89 },
                verdict: 'SCAM',
                confidence: 0.98,
                explanation_en: 'CRITICAL: "Digital Arrest" is a SCAM. Police NEVER video call for arrests.',
                explanation_hi: '‡§ñ‡§§‡§∞‡§æ: "‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§Ö‡§∞‡•á‡§∏‡•ç‡§ü" 100% ‡§∏‡•ç‡§ï‡•à‡§Æ ‡§π‡•à‡•§ ‡§™‡•Å‡§≤‡§ø‡§∏ ‡§ï‡§≠‡•Ä ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ï‡•â‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡•Ä‡•§',
                escalate: true,
                escalateReason: 'Digital Arrest scam - CRITICAL'
            },
            family_scam: {
                type: 'whatsapp',
                sender: '+91-NEW-NUMBER',
                senderName: 'Beta (Claimed)',
                message: 'Hi Papa, this is Rahul. New number. Emergency situation. Please send ‚Çπ15,000 to this UPI: xyz@oksbi urgently.',
                rules: ['FAMILY_IMPERSONATION', 'UPI_PRESENT', 'URGENCY'],
                ml: { label: 'SCAM', confidence: 0.72 },
                verdict: 'SCAM',
                confidence: 0.88,
                explanation_en: 'Family impersonation detected. ALWAYS verify by calling their OLD number.',
                explanation_hi: '‡§™‡§∞‡§ø‡§µ‡§æ‡§∞ ‡§ï‡§æ ‡§¨‡§π‡§æ‡§®‡§æ‡•§ ‡§™‡•Å‡§∞‡§æ‡§®‡•á ‡§®‡§Ç‡§¨‡§∞ ‡§™‡§∞ ‡§ï‡•â‡§≤ ‡§ï‡§∞‡§ï‡•á ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡•á‡§Ç!',
                escalate: true,
                escalateReason: 'Family impersonation with payment request'
            },
            safe_msg: {
                type: 'sms',
                sender: 'AMAZON',
                senderName: 'Amazon India',
                message: 'Your order #402-7891234 has been shipped and will arrive by Jan 18. Track at amazon.in/track',
                rules: [],
                ml: { label: 'SAFE', confidence: 0.91 },
                verdict: 'SAFE',
                confidence: 0.95,
                explanation_en: 'Legitimate order update from verified sender.',
                explanation_hi: '‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§™‡•ç‡§∞‡•á‡§∑‡§ï ‡§∏‡•á ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§Ö‡§™‡§°‡•á‡§ü‡•§',
                escalate: false
            }
        };

        async function runScenario(scenarioId) {
            const scenario = scenarios[scenarioId];

            // Highlight active scenario
            document.querySelectorAll('.scenario-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.scenario-btn').classList.add('active');

            // Reset warning overlay
            document.getElementById('warningOverlay').classList.add('hidden');

            // Update phone screen based on type
            await updatePhoneScreen(scenario);

            // Animate pipeline
            await animatePipeline(scenario);

            // Show warning if needed
            if (scenario.verdict !== 'SAFE') {
                await showWarning(scenario);
            }
        }

        async function updatePhoneScreen(scenario) {
            const content = document.getElementById('phoneContent');

            if (scenario.type === 'sms' || scenario.type === 'whatsapp') {
                content.innerHTML = `
                    <div class="sms-notification">
                        <div class="sms-header">
                            <span class="sms-sender">${scenario.type === 'whatsapp' ? 'üí¨ ' : 'üì± '}${scenario.senderName}</span>
                            <span class="sms-time">Just now</span>
                        </div>
                        <div class="sms-body">${scenario.message}</div>
                    </div>
                    <div style="text-align: center; color: #666; margin-top: 30px; font-size: 0.9rem;">
                        Analyzing message...
                    </div>
                `;
            } else if (scenario.type === 'call') {
                content.innerHTML = `
                    <div class="incoming-call">
                        <div class="caller-avatar">üìû</div>
                        <div class="caller-name">${scenario.callerName}</div>
                        <div class="caller-number">${scenario.caller}</div>
                        <div class="call-status pulsing">Incoming Call...</div>
                        <div class="call-actions">
                            <button class="call-btn decline">‚úï</button>
                            <button class="call-btn accept">‚úì</button>
                        </div>
                    </div>
                `;
            } else if (scenario.type === 'call_active') {
                content.innerHTML = `
                    <div class="incoming-call">
                        <div class="caller-avatar" style="background: linear-gradient(135deg, #ef4444, #dc2626);">üìû</div>
                        <div class="caller-name">${scenario.callerName}</div>
                        <div class="caller-number">${scenario.caller}</div>
                        <div class="call-duration">${Math.floor(scenario.duration / 60)}:${String(scenario.duration % 60).padStart(2, '0')}</div>
                        <div class="call-status" style="color: #fbbf24;">‚ö†Ô∏è Long call detected</div>
                    </div>
                `;
            } else if (scenario.type === 'video_call') {
                content.innerHTML = `
                    <div class="incoming-call shaking">
                        <div class="caller-avatar" style="background: linear-gradient(135deg, #ef4444, #7f1d1d);">üé•</div>
                        <div class="caller-name" style="color: #ef4444;">${scenario.callerName}</div>
                        <div class="caller-number">${scenario.caller}</div>
                        <div class="call-status" style="color: #ef4444;">üö® VIDEO CALL - DANGER</div>
                        <div style="margin-top: 20px; padding: 15px; background: rgba(239,68,68,0.2); border-radius: 10px; font-size: 0.85rem; color: #fca5a5;">
                            "${scenario.message}"
                        </div>
                    </div>
                `;
            }
        }

        async function animatePipeline(scenario) {
            const timeline = document.getElementById('pipelineTimeline');
            const ruleResults = document.getElementById('ruleResults');
            const mlResults = document.getElementById('mlResults');
            const systemDecision = document.getElementById('systemDecision');
            const explainability = document.getElementById('explainability');
            const guardianStatus = document.getElementById('guardianStatus');

            // Reset
            timeline.innerHTML = '';

            // Step 1: Input received
            await addTimelineItem(timeline, 'Input received', scenario.type.toUpperCase());
            await sleep(400);

            // Step 2: Rule Engine
            await addTimelineItem(timeline, 'Rule Engine processing...');
            await sleep(600);

            if (scenario.rules.length > 0) {
                ruleResults.innerHTML = scenario.rules.map(r =>
                    `<span class="rule-trigger">${r}</span>`
                ).join('');
                await addTimelineItem(timeline, `${scenario.rules.length} rules triggered`, 'ALERT');
            } else {
                ruleResults.innerHTML = '<span style="color: #22c55e;">‚úì No rules triggered</span>';
                await addTimelineItem(timeline, 'No rules triggered', 'PASS');
            }
            await sleep(400);

            // Step 3: DistilBERT
            await addTimelineItem(timeline, 'DistilBERT inference...');
            await sleep(800);

            const mlColor = scenario.ml.label === 'SCAM' ? '#ef4444' :
                scenario.ml.label === 'SUSPICIOUS' ? '#fbbf24' : '#22c55e';
            mlResults.innerHTML = `
                <div class="ml-result">
                    <span class="ml-label" style="color: ${mlColor}">${scenario.ml.label}</span>
                    <span class="ml-confidence">${Math.round(scenario.ml.confidence * 100)}% confidence</span>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill" style="width: ${scenario.ml.confidence * 100}%"></div>
                </div>
            `;
            await addTimelineItem(timeline, `ML: ${scenario.ml.label} (${Math.round(scenario.ml.confidence * 100)}%)`);
            await sleep(400);

            // Step 4: Decision
            await addTimelineItem(timeline, 'Combining signals...');
            await sleep(300);

            const verdictClass = scenario.verdict.toLowerCase();
            const verdictIcon = scenario.verdict === 'SCAM' ? 'üö®' :
                scenario.verdict === 'SUSPICIOUS' ? '‚ö†Ô∏è' : '‚úÖ';

            systemDecision.innerHTML = `
                <div class="decision-box ${verdictClass}">
                    <div class="decision-verdict ${verdictClass}">${verdictIcon} ${scenario.verdict}</div>
                    <div style="color: #888;">${Math.round(scenario.confidence * 100)}% confidence</div>
                </div>
            `;
            await addTimelineItem(timeline, `Decision: ${scenario.verdict}`, scenario.verdict);

            // Step 5: Explainability
            explainability.innerHTML = `
                <div class="explanation">
                    <div class="explanation-en">${scenario.explanation_en}</div>
                    <div class="explanation-hi">${scenario.explanation_hi}</div>
                </div>
            `;

            // Step 6: Guardian
            if (scenario.escalate) {
                await sleep(500);
                guardianStatus.innerHTML = `
                    <div class="guardian-alert">
                        <span class="guardian-icon">üì±</span>
                        <div>
                            <div class="guardian-text">${scenario.escalateReason}</div>
                            <div class="guardian-status">‚úì Alert sent to Rahul (Son)</div>
                        </div>
                    </div>
                `;
                await addTimelineItem(timeline, 'Guardian alerted via FCM', 'SENT');
            } else {
                guardianStatus.innerHTML = `
                    <div style="color: #666; font-size: 0.9rem;">
                        üë®‚Äçüë©‚Äçüëß Guardian paired: <strong>Son (Rahul)</strong><br>
                        <span style="color: #22c55e;">‚óè Online</span> ‚Äî No escalation needed
                    </div>
                `;
            }
        }

        async function addTimelineItem(timeline, text, status = '') {
            const item = document.createElement('div');
            item.className = 'timeline-item';

            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });

            let statusColor = '#888';
            if (status === 'ALERT' || status === 'SCAM') statusColor = '#ef4444';
            else if (status === 'PASS' || status === 'SAFE' || status === 'SENT') statusColor = '#22c55e';
            else if (status === 'SUSPICIOUS') statusColor = '#fbbf24';

            item.innerHTML = `
                <div>${text}</div>
                <div class="timeline-time">${time}${status ? ` ‚Ä¢ <span style="color:${statusColor}">${status}</span>` : ''}</div>
            `;
            timeline.appendChild(item);
        }

        async function showWarning(scenario) {
            await sleep(500);

            const overlay = document.getElementById('warningOverlay');
            const content = document.getElementById('warningContent');

            const verdictClass = scenario.verdict.toLowerCase();
            const icon = scenario.verdict === 'SCAM' ? 'üö®' : '‚ö†Ô∏è';

            content.innerHTML = `
                <div class="warning-icon">${icon}</div>
                <div class="warning-title ${verdictClass}">${scenario.verdict === 'SCAM' ? 'DANGER! Scam Detected' : 'Suspicious Activity'}</div>
                <div class="warning-reason">
                    ${scenario.explanation_en}<br><br>
                    <em>${scenario.explanation_hi}</em>
                </div>
                <div class="warning-actions">
                    <button class="warning-btn primary">üö´ Block & Report</button>
                    <button class="warning-btn secondary">üìû Call Family</button>
                    <button class="warning-btn secondary" onclick="document.getElementById('warningOverlay').classList.add('hidden')">‚úï Dismiss</button>
                </div>
            `;

            overlay.classList.remove('hidden');
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>

</html>